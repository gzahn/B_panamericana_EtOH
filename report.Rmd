---
title: "Ethanol Growth Report"
author: "Geoffrey Zahn"
date: "4/20/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE,warning = FALSE)


library(tidyverse)
library(easystats)
library(patchwork)
library(broom)
'%ni%' <- Negate('%in%')
theme_set(theme_minimal())

df <- read_csv("./data/results.csv")
```


# **Protocol:**

**Replication of Ewaze, *et al.*, 2008, Figure 4 - "Effect of ethanol vapour on dormant cell germination"**

Ewaze, J. O., Summerbell, R. C., & Scott, J. A. (2008). Ethanol physiology in the warehouse-staining fungus, Baudoinia compniacensis. Mycological Research, 112(11), 1373â€“1380. https://doi.org/10.1016/j.mycres.2008.05.003

**Design**

6 Treatments (Sterile control, Acetone 10ppm control, Ethanol 0.1ppm, Ethanol 1ppm, Ethanol 10ppm, Ethanol 100ppm)

5 replicate subjects per treatment

Grow dormant colonies on sterile filters for 14 days in vapor treatment chambers

Count resultant colonies on filters

Analyze with One-way ANOVA and GLM (Colony count ~ treatment)

___

```{r}
# find control group measures
H2O_control <- df %>% 
  filter(Treatment == "H2O") %>% 
  summarize(H2O_mean=mean(CFUs),
            H2O_sd=sd(CFUs),
            H2O_upper=H2O_mean + H2O_sd,
            H2O_lower=H2O_mean - H2O_sd)
Acetone_control <- df %>% 
  filter(Treatment == "Acetone") %>% 
  summarize(Acetone_mean=mean(CFUs),
            Acetone_sd=sd(CFUs),
            Acetone_upper=Acetone_mean + Acetone_sd,
            Acetone_lower=Acetone_mean - Acetone_sd)
controls <- cbind(H2O_control,Acetone_control)
```


```{r}
# build plots
etoh <- df %>% 
  filter(Treatment == "EtOH") %>% 
  mutate(Concentration_ppm = factor(Concentration_ppm,levels = c("0.1","1","10","100")))

h2o_plot <- 
etoh %>% 
  ggplot(aes(x=Concentration_ppm,y=100*(CFUs/H2O_control$H2O_mean),fill=Concentration_ppm)) +
  geom_boxplot() +
  labs(x="Ethanol conc. (ppm)",
       title="Post-exposure germination\nvs water control (%)",
       y=NULL) +
  geom_hline(yintercept=100*H2O_control$H2O_mean/H2O_control$H2O_mean) +
  geom_hline(yintercept=100*H2O_control$H2O_upper/H2O_control$H2O_mean, linetype=2) +
  geom_hline(yintercept=100*H2O_control$H2O_lower/H2O_control$H2O_mean, linetype=2) +
  coord_cartesian(ylim=c(0,max(100*(etoh$CFUs/H2O_control$H2O_mean)))) +
  # annotate("text",x=2.5,y=107,label="Water control values") +
  theme(axis.text = element_text(face='bold',size=12),
        legend.position = 'none')

acetone_plot <- 
etoh %>% 
  ggplot(aes(x=Concentration_ppm,y=100*(CFUs/Acetone_control$Acetone_mean),fill=Concentration_ppm)) +
  geom_boxplot() +
  labs(x="Ethanol conc. (ppm)",
       title="Post-exposure germination\nvs acetone control (%)",
       y=NULL) +
  geom_hline(yintercept=100*Acetone_control$Acetone_mean/Acetone_control$Acetone_mean) +
  geom_hline(yintercept=100*Acetone_control$Acetone_upper/Acetone_control$Acetone_mean, linetype=2) +
  geom_hline(yintercept=100*Acetone_control$Acetone_lower/Acetone_control$Acetone_mean, linetype=2) +
  coord_cartesian(ylim=c(0,max(100*(etoh$CFUs/H2O_control$H2O_mean)))) +
  # annotate("text",x=2.5,y=107,label="Acetone control values") +
  theme(axis.text = element_text(face='bold',size=12),
        legend.position = 'none')

```


```{r}
# run stats
etoh <- etoh %>% 
  mutate(relative_growth_h2o = 100 * CFUs / controls$H2O_mean,
         relative_growth_acetone = 100 * CFUs / controls$Acetone_mean)


water_cfus <- df %>% 
  filter(Treatment == "H2O") %>% 
  pluck("CFUs")
acetone_cfus <- df %>% 
  filter(Treatment == "Acetone") %>% 
  pluck("CFUs") 
cfus_0.1 <- df %>% 
  filter(Concentration_ppm == "0.1") %>% 
  pluck("CFUs")
cfus_1 <- df %>% 
  filter(Concentration_ppm == "1") %>% 
  pluck("CFUs")
cfus_10 <- df %>% 
  filter(Concentration_ppm == "10") %>% 
  pluck("CFUs")
cfus_100 <- df %>% 
  filter(Concentration_ppm == "100") %>% 
  pluck("CFUs")

# water t.tests
water_ttests <- list()
for(i in ls(pattern = "cfus_")){
  d <- get(i)
  water_ttests[[i]] <- t.test(d,water_cfus) %>% tidy()
}

# acetone_ttests
acetone_ttests <- list()
for(i in ls(pattern = "cfus_")){
  d <- get(i)
  acetone_ttests[[i]] <- t.test(d,acetone_cfus) %>% tidy()
}



```

___

# **Results:**


```{r}

# add meaningful fill color to plots
fillcolors <- data.frame(
Water_Diff = water_ttests %>% 
  map(5) %>% 
    map_lgl(function(x){x<0.05}),
Acetone_Diff = acetone_ttests %>% 
  map(5) %>% 
    map_lgl(function(x){x<0.05})
) %>% 
  mutate(PPM=row.names(.)) %>% 
  select(PPM,Water_Diff,Acetone_Diff) %>% 
  mutate(PPM=PPM %>% str_remove("cfus_")) %>% 
  mutate(watercolor=case_when(Water_Diff == TRUE ~ "DarkGreen",
                              TRUE ~ "Gray"),
         acetonecolor=case_when(Acetone_Diff == TRUE ~ "DarkGreen",
                                TRUE ~ "Gray"))

# adapt plots to have meaningful fill colors

h2o_plot <- h2o_plot + 
  scale_fill_manual(values = fillcolors$watercolor)
  
  
acetone_plot <- acetone_plot +
  scale_fill_manual(values = fillcolors$acetonecolor)
  
h2o_plot + acetone_plot


```

Figure 1.

Post-exposure germination values shown as percentages of sterile water and acetone control germination values. Control germination ranges shown in horizontal zones around 100%. Green boxes indicate germination values that differed significantly from the respective control values.

<br>

___

<br>

```{r}
data.frame(
Water_Diff = water_ttests %>% 
  map(5) %>% 
    map_lgl(function(x){x<0.05}),
Acetone_Diff = acetone_ttests %>% 
  map(5) %>% 
    map_lgl(function(x){x<0.05})
) %>% 
  mutate(PPM=row.names(.)) %>% 
  select(PPM,Water_Diff,Acetone_Diff) %>% 
  mutate(PPM=PPM %>% str_remove("cfus_")) %>% 
  remove_rownames() %>% 
  kableExtra::kable() %>% 
  kableExtra::kable_classic(lightable_options = c('hover')) 

```

Table 1 - Shows whether there was a statistically significant difference between observed growth and controls (both water and acetone) for each concentration of Ethanol. Paired T-tests were conducted between each ethanol concentration and the respective control.


```{r}
df %>% 
  mutate(Relative_germination_acetone = CFUs / controls$Acetone_mean,
         Relative_germination_water = CFUs / controls$H2O_mean) %>% 
  # mutate(Concentration_ppm = factor(Concentration_ppm,levels = c("0.1","1","10","100"))) %>% 
  pivot_longer(starts_with("Relative_"),
               names_to = "Control",
               names_prefix = "Relative_germination_",
               values_to = "Relative_germination") %>% 
  filter(Treatment == "EtOH") %>% 
  glm(formula = Relative_germination ~ Concentration_ppm + Control,
      data = .) %>% 
  report()
  

```